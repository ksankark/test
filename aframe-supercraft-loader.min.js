!function(e){var t={};function i(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(r,o,function(t){return e[t]}.bind(null,o));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=10)}([function(e,t){var i=new THREE.Color;AFRAME.registerComponent("vertex-colors-buffer",{schema:{baseColor:{type:"color"},itemSize:{default:3}},update:function(e){var t,r,o,s,a=this.data,n=this.el,l=this;if((s=this.el.getObject3D("mesh"))&&s.geometry)if((o=s.geometry).attributes.position){for(o.attributes.color||o.addAttribute("color",new THREE.BufferAttribute(new Float32Array(o.attributes.position.array.length),3)),t=o.attributes.color.array,i.set(a.baseColor),r=0;r<t.length;r+=a.itemSize)t[r]=i.r,t[r+1]=i.g,t[r+2]=i.b;o.attributes.color.needsUpdate=!0}else console.warn("Geometry has no vertices",n);else n.addEventListener("object3dset",function t(i){"mesh"===i.detail.type&&(n.removeEventListener("object3dset",t),l.update(e))})}})},function(e,t){e.exports={default:{},parse:function(e){return e?"string"!=typeof e?e:(e=e.replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": '),JSON.parse(e)):null},stringify:JSON.stringify}},function(e,t,i){var r=i(1);AFRAME.registerComponent("face-colors",{schema:{baseColor:{type:"color"},faceColors:r,variation:{default:.05}},update:function(e){var t,i,r,o,s,a=this.data,n=this.el,l=this;if((s=n.getObject3D("mesh"))&&s.geometry){if(r=s.geometry,e.baseColor!==a.baseColor)for(o=0;o<r.faces.length;o++)r.faces[o].color.set(a.baseColor).addScalar(Math.random()*a.variation);for(t in a.faceColors)for(i=a.faceColors[t],o=0;o<i.length;o++){if(faceIndex=i[o],!r.faces[faceIndex])return;r.faces[faceIndex].color.set(t)}r.colorsNeedUpdate=!0}else n.addEventListener("componentinitialized",function t(i){"geometry"===i.detail.name&&(n.removeEventListener("componentinitialized",t),l.update(e))})},remove:function(){var e,t;if(this.el.getObject3D("mesh"))for(e=this.el.getObject3D("mesh").geometry,t=0;t<e.faces.length;t++)e.faces[t].color.setRGB(1,1,1)}})},function(e,t,i){i(2),i(0);var r={};r.menuIcon=new THREE.CanvasTexture(function(e,t){var i,r,o;return(i=document.createElement("canvas")).setAttribute("height","1024"),i.setAttribute("width","1024"),i.setAttribute("id","menuIconsAtlas"),i.style.display="none",r=i.getContext("2d"),(o=new Image).onload=(()=>{r.drawImage(o,0,0,1024,1024),t(i)}),o.src=e,i}("assets/img/menuIcons.svg",e=>{document.addEventListener("DOMContentLoaded",()=>{document.body.appendChild(e)}),r.menuIcon.needsUpdate=!0}));var o={faded:{type:"MeshPhongMaterial",emissive:"#333",emissiveIntensity:.5,transparent:!0,opacity:.65,flatShading:!0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide},menuIcon:{type:"MeshBasicMaterial",flatShading:!0,transparent:!0,map:r.menuIcon,vertexColors:THREE.FaceColors,side:THREE.DoubleSide},phong:{type:"MeshPhongMaterial",emissive:"#333",emissiveIntensity:.5,flatShading:!0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide}},s={};function a(e,t){e.getObject3D("mesh")?t(e.getObject3D("mesh")):e.addEventListener("object3dset",function i(r){"mesh"===r.detail.type&&(e.removeEventListener("object3dset",i),t(e.getObject3D("mesh")))})}AFRAME.registerSystem("super-material",{init:function(){var e,t;for(e in this.config=o,this.materials=s,o)t=o[e],s[e]=new THREE[t.type](t),s[e].shadowSide=THREE.BackSide}}),AFRAME.registerComponent("super-material",{schema:{color:{default:""},type:{default:"phong"}},init:function(){var e=this.data;a(this.el,t=>{t.material=s[e.type],this.setColor()}),this.el.addEventListener("componentchanged",e=>{"geometry"!==e.detail.name&&"slice9"!==e.detail.name||this.setColor()})},update:function(e){var t=this.data;e.type&&e.type!==t.type&&(this.el.getObject3D("mesh").material=s[t.type]),t.color&&e.color!==t.color&&a(this.el,()=>{this.setColor()})},setColor:function(){var e=this.data,t=this.el;e.color&&(-1===t.getObject3D("mesh").geometry.type.indexOf("BufferGeometry")?(t.removeAttribute("face-colors"),t.setAttribute("face-colors","baseColor",e.color)):(t.removeAttribute("vertex-colors-buffer"),setTimeout(()=>{t.setAttribute("vertex-colors-buffer","baseColor",e.color)})))}})},function(e,t){e.exports.SHAPES={box:{primitive:"box",depth:.1,height:.1,width:.1,segmentsDepth:1,segmentsHeight:1,segmentsWidth:1},cone:{primitive:"cone",height:.1,radiusBottom:.05,radiusTop:1e-4,segmentsHeight:0,segmentsRadial:0,legacy:!0},cone2:{primitive:"cone",height:.1,radiusBottom:.05,radiusTop:1e-4,segmentsHeight:0,segmentsRadial:8},frustum:{primitive:"cone",height:.05,radiusBottom:.05,radiusTop:.025,segmentsHeight:0,segmentsRadial:8},cylinder:{primitive:"cylinder",height:.1,radius:.1,segmentsHeight:0,segmentsRadial:0,legacy:!0},cylinder2:{primitive:"cylinder",height:.1,radius:.1,segmentsHeight:0,segmentsRadial:8},decagon:{detail:1,primitive:"tetrahedron",radius:.1},dodecahedron:{primitive:"dodecahedron",radius:.1},quartertorus:{arc:90,primitive:"torus",radius:.1,radiusTubular:.01,segmentsRadial:6,segmentsTubular:12,legacy:!0},quartertorus2:{arc:90,primitive:"torus",radius:.1,radiusTubular:.01,segmentsRadial:8,segmentsTubular:3},octahedron:{primitive:"octahedron",detail:0,radius:.1},semicylinder:{primitive:"cylinder",height:.1,radius:.1,thetaLength:180,thetaStart:90,segmentsHeight:0,segmentsRadial:0,legacy:!0},semicylinder2:{primitive:"cylinder",height:.1,radius:.1,thetaLength:180,thetaStart:90,segmentsHeight:0,segmentsRadial:4},semisphere:{primitive:"sphere",segmentsHeight:6,segmentsWidth:6,radius:.1,phiLength:180,legacy:!0},semisphere2:{primitive:"sphere",segmentsHeight:3,segmentsWidth:8,radius:.1,thetaLength:90},semitorus:{arc:180,primitive:"torus",radius:.1,radiusTubular:.01,segmentsRadial:6,segmentsTubular:12},semitorus2:{arc:180,primitive:"torus",radius:.1,radiusTubular:.01,segmentsRadial:8,segmentsTubular:4},sinTube:{primitive:"sinTube",radius:.03,scale:.1},sphere:{primitive:"sphere",segmentsHeight:6,segmentsWidth:6,radius:.1,legacy:!0},sphere2:{primitive:"sphere",segmentsHeight:6,segmentsWidth:8,radius:.1},tetrahedron:{detail:0,primitive:"tetrahedron",radius:.1},triangleprism:{primitive:"trianglePrism",height:.1,sideLength:.1},torus:{arc:360,primitive:"torus",radius:.1,radiusTubular:.01,segmentsRadial:8,segmentsTubular:8},torus2:{arc:360,primitive:"torus",radius:.1,radiusTubular:.01,segmentsRadial:8,segmentsTubular:8,legacy:!0}},e.exports.SHAPE_ROTATIONS={semicylinder:new THREE.Euler(Math.PI/2,0,0),semicylinder2:new THREE.Euler(Math.PI/2,0,0),semisphere:new THREE.Euler(-Math.PI/2,0,0),tetrahedron:new THREE.Euler(0,0,-Math.PI/4)}},function(e,t,i){var r=i(4).SHAPES;r=AFRAME.utils.clone(r),AFRAME.registerGeometry("sinTube",{schema:{radius:{default:1},scale:{default:1}},init:function(){function e(e){THREE.Curve.call(this),this.scale=void 0===e?1:e}return e.prototype=Object.create(THREE.Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=function(e){var t=3*e-1.5,i=Math.sin(2*Math.PI*e);return new THREE.Vector3(t,i,0).multiplyScalar(this.scale)},function(t){this.geometry=new THREE.TubeGeometry(new e(t.scale),10,t.radius,6,!1)}}()}),AFRAME.registerGeometry("trianglePrism",{schema:{thickness:{default:1},sideLength:{default:1}},init:function(){var e;function t(t,i){var r,o;o=[new THREE.Vector2(-.5,-.5).multiplyScalar(t),new THREE.Vector2(.5,-.5).multiplyScalar(t),new THREE.Vector2(.5,.5).multiplyScalar(t)],function(e){e.moveTo(o[0].x,o[0].y);for(var t=1;t<o.length;t++)e.lineTo(o[t].x,o[t].y);e.lineTo(o[0].x,o[0].y)}(r=new THREE.Shape),e.amount=i,THREE.ExtrudeGeometry.call(this,r,e)}return e={height:1,bevelEnabled:!1},t.prototype=Object.create(THREE.ExtrudeGeometry.prototype),function(e){this.geometry=new t(e.sideLength,e.height)}}()}),AFRAME.registerComponent("super-geometry",{schema:{type:{type:"string"}},update:function(){var e=this.el;if(r[this.data.type])switch(r[this.data.type].buffer=!1,r[this.data.type].skipCache=!0,delete r[this.data.type].legacy,e.setAttribute("geometry",r[this.data.type],!0),this.data.type){case"semicylinder":case"semicylinder2":e.getObject3D("mesh").geometry.translate(0,0,.05);break;case"semisphere":e.getObject3D("mesh").geometry.translate(0,0,-.05);break;case"semisphere2":case"semitorus":case"semitorus2":e.getObject3D("mesh").geometry.translate(0,-.05,0);break;case"quartertorus":case"quartertorus2":e.getObject3D("mesh").geometry.translate(-.05,-.06,0);break;case"triangleprism":e.getObject3D("mesh").geometry.translate(0,0,-.05)}}})},function(e,t){var i={black:{skyColor:"#000000",horizonColor:"#1d1d1d",groundColor:"#5c5c5c"},blue:{skyColor:"#5992e6",horizonColor:"#b8e7e7",groundColor:"#3da3c9"},brown:{skyColor:"#125598",horizonColor:"#b9e6f4",groundColor:"#7a4941"},darkbrown:{skyColor:"#118faa",horizonColor:"#96e0ac",groundColor:"#705134"},darkgray:{skyColor:"#1a1a1a",horizonColor:"#272727",groundColor:"#676767"},darkpink:{skyColor:"#3c354d",horizonColor:"#7d564d",groundColor:"#695641"},darkred:{skyColor:"#000000",horizonColor:"#781a12",groundColor:"#701710"},gray:{skyColor:"#5b5b5b",horizonColor:"#787878",groundColor:"#585858"},green:{skyColor:"#1f5b98",horizonColor:"#b0f4e7",groundColor:"#517139"},lightblue:{skyColor:"#38a3f1",horizonColor:"#c1eee1",groundColor:"#a47142"},lightgray:{skyColor:"#667d97",horizonColor:"#c0c0c0",groundColor:"#6c886d"},lightpurple:{skyColor:"#915CB9",horizonColor:"#ebca8d",groundColor:"#597c36"},orange:{skyColor:"#ed741b",horizonColor:"#fbc173",groundColor:"#2c6c94"},orangered:{skyColor:"#e64a1e",horizonColor:"#d7bf1a",groundColor:"#326135"},pink:{skyColor:"#EDA78A",horizonColor:"#f7ebc8",groundColor:"#af8674"},purple:{skyColor:"#6B3869",horizonColor:"#1d1238",groundColor:"#8c56a9"},red:{skyColor:"#821c13",horizonColor:"#1c6177",groundColor:"#981b1e"},teal:{skyColor:"#00b295",horizonColor:"#e6e1aa",groundColor:"#b5742d"},white:{skyColor:"#c7c7c7",horizonColor:"#e6e6df",groundColor:"#d4d4d4"},yellow:{skyColor:"#15ae71",horizonColor:"#c9c130",groundColor:"#a38b56"}},r={black:{color:"#c8c8c8",intensity:"0.15"},blue:{color:"#FFFFFF",intensity:"0.8"},brown:{color:"#e6dbc8",intensity:"1"},darkbrown:{color:"#f7f2c1",intensity:"1"},darkgray:{color:"#747474",intensity:"0.45"},darkpink:{color:"#d19156",intensity:"0.7"},darkred:{color:"#3e7c84",intensity:"0.35"},gray:{color:"#FFFFFF",intensity:"0.65"},green:{color:"#faf8d3",intensity:1},lightblue:{color:"#cef0ec",intensity:"0.95"},lightgray:{color:"#FFFFFF",intensity:"0.8"},lightpurple:{color:"#efc472",intensity:"0.95"},orange:{color:"#fbb168",intensity:"1"},orangered:{color:"#f5f283",intensity:1},pink:{color:"#fceee0",intensity:"0.8"},purple:{color:"#9cb5e2",intensity:"0.55"},red:{color:"#56cfe4",intensity:"0.75"},teal:{color:"#d1ceba",intensity:1},white:{color:"#dee2e2",intensity:"0.9"},yellow:{color:"#e7d34b",intensity:"0.75"}};AFRAME.registerComponent("super-environment-updater",{schema:{buildMode:{default:!1},craftMode:{default:!1},isSiteLoading:{default:!1},preset:{default:"teal"}},init:function(){this.resetValues={dressing:"none",ground:"flat",groundColor2:"#b5742d",groundColor:"#b5742d",groundTexture:"squares",groundYScale:1,horizonColor:"#e6e1aa",lighting:"none",preset:"default",shadow:!0,skyColor:"#00b295",skyType:"gradient"},this.buildMode={grid:"1x1",gridColor:"#717317"},this.craftMode={grid:"crosses",gridColor:"#24B59F",groundColor2:"#626262",groundColor:"#5B5B5B",skyColor:"#808080"},this.loadingMode={grid:"none",gridColor:"#24B59F",groundColor2:"#333",groundColor:"#222",skyColor:"#010101"},this.playMode={grid:"none"},this.createEnvironment()},update:function(){var e={};return function(t){var r=this.envEl;Object.assign(e,this.resetValues),envPreset=i[this.data.preset],envPreset.groundColor2=envPreset.groundColor,Object.assign(e,envPreset),this.setLights(),this.data.isSiteLoading?(Object.assign(e,this.loadingMode),r.setAttribute("super-environment",e)):this.data.buildMode?(Object.assign(e,this.buildMode),r.setAttribute("super-environment",e)):this.data.craftMode?(Object.assign(e,this.craftMode),r.setAttribute("super-environment",e)):(Object.assign(e,this.playMode),r.setAttribute("super-environment",e))}}(),createEnvironment:function(){this.envEl=document.createElement("a-entity"),this.envEl.setAttribute("id","superEnvironment"),this.ambientlightEl=document.createElement("a-entity"),this.ambientlightEl.setAttribute("id","superLightAmbient"),this.ambientlightEl.setAttribute("light",{type:"ambient",color:"#111",intensity:1}),this.envEl.appendChild(this.ambientlightEl),this.hemilightEl=document.createElement("a-entity"),this.hemilightEl.setAttribute("id","superLightHemisphere"),this.hemilightEl.setAttribute("light",{type:"hemisphere",intensity:.5,groundColor:"#FFF",color:"#24B59F"}),this.envEl.appendChild(this.hemilightEl),this.keylightEl=document.createElement("a-entity"),this.keylightEl.setAttribute("id","superLightDirectional"),this.keylightEl.setAttribute("light",{castShadow:!0,color:"#d58f62",intensity:.8,shadowBias:-1e-4,shadowCameraBottom:-20,shadowCameraFov:360,shadowCameraLeft:-20,shadowCameraNear:.01,shadowCameraRight:20,shadowCameraTop:20,shadowMapHeight:2048,shadowMapWidth:2048}),this.keylightEl.object3D.position.set(2,9,2),this.envEl.appendChild(this.keylightEl),this.el.sceneEl.appendChild(this.envEl)},setLights:function(){var e={},t={};return function(){var i;i=r[this.data.preset],e.color=i.color,e.intensity=i.intensity,this.keylightEl.setAttribute("light",e),t.color=envPreset.skyColor,t.groundColor=envPreset.groundColor,t.intensity=.5*i.intensity,this.hemilightEl.setAttribute("light",t),this.ambientlightEl.setAttribute("light","intensity",i.intensity)}}()})},function(e,t){var i={};if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("super-environment",{schema:{active:{default:!1},preset:{default:"default",oneOf:["none","default","contact","egypt","checkerboard","forest","goaland","yavapai","goldmine","arches","threetowers","poison","tron","japan","dream","volcano","starry","osiris"]},seed:{type:"int",default:1,min:0,max:1e3},skyType:{default:"color",oneOf:["none","color","gradient","atmosphere"]},skyColor:{type:"color"},horizonColor:{type:"color"},lighting:{default:"distant",oneOf:["none","distant","point"]},shadow:{default:!1},shadowSize:{default:10},lightPosition:{type:"vec3",default:{x:0,y:1,z:-.2}},fog:{type:"float",default:0,min:0,max:1},flatShading:{default:!1},playArea:{type:"float",default:1,min:1,max:100},ground:{default:"hills",oneOf:["none","flat","hills","canyon","spikes","noise"]},groundYScale:{type:"float",default:3,min:0,max:50},groundTexture:{default:"none",oneOf:["none","checkerboard","squares","walkernoise"]},groundColor:{type:"color",default:"#553e35"},groundColor2:{type:"color",default:"#694439"},dressing:{default:"none",oneOf:["none","cubes","pyramids","cylinders","hexagons","stones","trees","mushrooms","towers","apparatus","arches","torii"]},dressingAmount:{type:"int",default:10,min:0,max:1e3},dressingColor:{type:"color",default:"#795449"},dressingScale:{type:"float",default:5,min:0,max:100},dressingVariance:{type:"vec3",default:{x:1,y:1,z:1}},dressingUniformScale:{default:!0},dressingOnPlayArea:{type:"float",default:0,min:0,max:1},grid:{default:"none",oneOf:["none","1x1","2x2","crosses","dots","xlines","ylines"]},gridColor:{type:"color",default:"#ccc"}},multiple:!1,presets:{none:{},default:{active:!0,seed:1,skyType:"atmosphere",skyColor:"#88c",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:-.11,y:1,z:.33},fog:.78,flatShading:!1,playArea:1,ground:"hills",groundYScale:3,groundTexture:"checkerboard",groundColor:"#454545",groundColor2:"#5d5d5d",dressing:"none",dressingAmount:10,dressingColor:"#795449",dressingScale:1,dressingVariance:{x:0,y:0,z:0},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"none",gridColor:"#ccc",shadow:!1},contact:{active:!0,seed:14,skyType:"gradient",skyColor:"#478d54",horizonColor:"#b696cb",lighting:"distant",lightPosition:{x:0,y:2.01,z:-1},fog:.8,flatShading:!1,playArea:1,ground:"spikes",groundYScale:4.91,groundTexture:"none",groundColor:"#2e455f",groundColor2:"#694439",dressing:"apparatus",dressingAmount:7,dressingColor:"#657067",dressingScale:20,dressingVariance:{x:20,y:20,z:20},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"1x1",gridColor:"#478d54",shadow:!1},egypt:{active:!0,seed:26,skyType:"gradient",skyColor:"#1b7660",horizonColor:"#e4b676",lighting:"distant",lightPosition:{x:0,y:1.65,z:-1},fog:.75,flatShading:!1,playArea:1,ground:"hills",groundYScale:5,groundTexture:"walkernoise",groundColor:"#664735",groundColor2:"#6c4b39",dressing:"pyramids",dressingAmount:10,dressingColor:"#7c5c45",dressingScale:5,dressingVariance:{x:20,y:20,z:20},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"spots",gridColor:"#e4b676",shadow:!1},checkerboard:{active:!0,seed:1,skyType:"gradient",skyColor:"#0d0d0d",horizonColor:"#404040",lighting:"distant",lightPosition:{x:0,y:1,z:-.2},fog:.81,flatShading:!0,playArea:1,ground:"hills",groundYScale:4.81,groundTexture:"checkerboard",groundColor:"#252525",groundColor2:"#111111",dressing:"cubes",dressingAmount:10,dressingColor:"#9f9f9f",dressingScale:1.51,dressingVariance:{x:5,y:20,z:5},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"dots",gridColor:"#ccc",shadow:!1},forest:{active:!0,seed:8,skyType:"gradient",skyColor:"#24b59f",horizonColor:"#eff9b7",lighting:"distant",lightPosition:{x:-1.2,y:.88,z:-.55},fog:.8,flatShading:!1,playArea:1,ground:"noise",groundYScale:4.18,groundTexture:"squares",groundColor:"#937a24",groundColor2:"#987d2e",dressing:"trees",dressingAmount:500,dressingColor:"#888b1d",dressingScale:1,dressingVariance:{x:10,y:10,z:10},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"none",gridColor:"#c5a543",shadow:!1},goaland:{active:!0,seed:17,skyType:"gradient",skyColor:"#14645f",horizonColor:"#a3dab8",lighting:"point",lightPosition:{x:.1,y:4,z:.56},fog:.73,flatShading:!1,playArea:1,ground:"noise",groundYScale:.81,groundTexture:"none",groundColor:"#ae3241",groundColor2:"#db4453",dressing:"mushrooms",dressingAmount:150,dressingColor:"#a9313d",dressingScale:5,dressingVariance:{x:5,y:10,z:5},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"dots",gridColor:"#239893",shadow:!1},yavapai:{active:!0,seed:11,skyType:"gradient",skyColor:"#239849",horizonColor:"#cfe0af",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!0,playArea:1,ground:"canyon",groundYScale:9.76,groundTexture:"walkernoise",groundColor:"#C66344",groundColor2:"#c96b4b",dressing:"stones",dressingAmount:500,dressingColor:"#C66344",dressingScale:.06,dressingVariance:{x:.2,y:.1,z:.2},dressingUniformScale:!0,dressingOnPlayArea:1,grid:"none",gridColor:"#239893",shadow:!1},goldmine:{active:!0,seed:53,skyType:"gradient",skyColor:"#1e1c1a",horizonColor:"#8c7964",lighting:"point",lightPosition:{x:-.09,y:3,z:.33},fog:.43,flatShading:!0,playArea:1.08,ground:"canyon",groundYScale:50,groundTexture:"none",groundColor:"#353535",groundColor2:"#454545",dressing:"hexagons",dressingAmount:300,dressingColor:"#fe921b",dressingScale:.5,dressingVariance:{x:2,y:8,z:2},dressingUniformScale:!0,dressingOnPlayArea:.03,grid:"none",gridColor:"#ccc",shadow:!1},threetowers:{active:!0,seed:5,skyType:"gradient",skyColor:"#23a06b",horizonColor:"#f5e170",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!1,playArea:1,ground:"spikes",groundYScale:4.26,groundTexture:"walkernoise",groundColor:"#273a49",groundColor2:"#2b464f",dressing:"towers",dressingAmount:3,dressingColor:"#5f6d94",dressingScale:50,dressingVariance:{x:10,y:100,z:10},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"none",gridColor:"#239893",shadow:!1},poison:{active:!0,seed:92,skyType:"gradient",skyColor:"#1ea84a",horizonColor:"#177132",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!1,playArea:1,ground:"canyon",groundYScale:9.76,groundTexture:"none",groundColor:"#851f31",groundColor2:"#912235",dressing:"hexagons",dressingAmount:20,dressingColor:"#c7415b",dressingScale:20,dressingVariance:{x:20,y:200,z:20},dressingUniformScale:!1,dressingOnPlayArea:0,grid:"crosses",gridColor:"#1ea84a",shadow:!1},arches:{active:!0,seed:19,skyType:"atmosphere",skyColor:"#8cbdc8",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:-.11,y:.16,z:.33},fog:.67,flatShading:!0,playArea:1,ground:"canyon",groundYScale:10,groundTexture:"walkernoise",groundColor:"#a87d6f",groundColor2:"#795449",dressing:"arches",dressingAmount:6,dressingColor:"#795449",dressingScale:26,dressingVariance:{x:20,y:40,z:20},dressingUniformScale:!0,dressingOnPlayArea:.04,grid:"none",gridColor:"#ccc",shadow:!1},tron:{active:!0,seed:14,skyType:"gradient",skyColor:"#091b39",horizonColor:"#284a9e",lighting:"distant",lightPosition:{x:-.72,y:.62,z:.4},fog:.8,flatShading:!1,playArea:1,ground:"spikes",groundYScale:4.91,groundTexture:"none",groundColor:"#061123",groundColor2:"#694439",dressing:"towers",dressingAmount:5,dressingColor:"#fb000e",dressingScale:15,dressingVariance:{x:20,y:20,z:20},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"1x1",gridColor:"#fb000e",shadow:!1},japan:{active:!0,seed:14,skyType:"gradient",skyColor:"#7e5db5",horizonColor:"#b4adda",lighting:"distant",lightPosition:{x:1.33,y:1,z:.24},fog:.9,flatShading:!1,playArea:1,ground:"hills",groundYScale:25,groundTexture:"walkernoise",groundColor:"#7e5db5",groundColor2:"#cabdf5",dressing:"torii",dressingAmount:4,dressingColor:"#bc5e7c",dressingScale:15,dressingVariance:{x:0,y:0,z:0},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"spots",gridColor:"#e4b676",shadow:!1},dream:{active:!0,seed:17,skyType:"gradient",skyColor:"#87faf4",horizonColor:"#b34093",lighting:"distant",lightPosition:{x:-.72,y:.53,z:.97},fog:.8,flatShading:!1,playArea:1,ground:"hills",groundYScale:20,groundTexture:"checkerboard",groundColor:"#b34093",groundColor2:"#c050a2",dressing:"mushrooms",dressingAmount:300,dressingColor:"#3cf7ed",dressingScale:.2,dressingVariance:{x:.2,y:.2,z:.2},dressingUniformScale:!0,dressingOnPlayArea:1,grid:"none",gridColor:"#239893",shadow:!1},volcano:{active:!0,seed:92,skyType:"gradient",skyColor:"#4a070f",horizonColor:"#f62300",lighting:"point",lightPosition:{x:.5,y:2.25,z:0},fog:.87,flatShading:!1,playArea:1,ground:"canyon",groundYScale:9.76,groundTexture:"walkernoise",groundColor:"#fb0803",groundColor2:"#510000",dressing:"arches",dressingAmount:15,dressingColor:"#fb0803",dressingScale:3,dressingVariance:{x:10,y:100,z:10},dressingUniformScale:!1,dressingOnPlayArea:.2,grid:"none",gridColor:"#fa0e00",shadow:!1},starry:{active:!0,seed:1,skyType:"atmosphere",skyColor:"#88c",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:0,y:-.01,z:-.46},fog:.7,flatShading:!1,playArea:1,ground:"hills",groundYScale:3,groundTexture:"none",groundColor:"#553e35",groundColor2:"#694439",dressing:"none",dressingAmount:100,dressingColor:"#795449",dressingScale:5,dressingVariance:{x:1,y:1,z:1},dressingUniformScale:!0,grid:"1x1",dressingOnPlayArea:0,gridColor:"#39d2f2",shadow:!1},osiris:{active:!0,seed:46,skyType:"atmosphere",skyColor:"#88c",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:0,y:.02,z:-.46},fog:0,flatShading:!1,playArea:1,ground:"hills",groundYScale:3,groundTexture:"none",groundColor:"#9e7b47",groundColor2:"#9e7b47",dressing:"pyramids",dressingAmount:7,dressingColor:"#9e7b47",dressingScale:5,dressingVariance:{x:30,y:30,z:30},dressingUniformScale:!0,grid:"dots",dressingOnPlayArea:0,gridColor:"#daa452",shadow:!1}},init:function(){for(var e in this.STAGE_SIZE=30,this.assets={arches:[{type:"mesh",vertices:[409,268,4,351,228,36,336,236,-57,-152,391,69,-135,358,88,-119,330,43,-20,358,-35,-153,357,-47,37,413,-26,-20,411,-14,-302,148,154,-339,121,-126,-389,200,-88,-477,193,-76,-314,346,-19,-314,306,-30,-250,296,-73,-267,237,-82,-212,303,-68,-245,200,-67,-223,304,108,-329,299,107,-289,350,76,-320,342,69,119,373,-39,38,370,8,113,367,52,492,202,-31,462,83,-104,447,71,-80,426,112,25,482,189,-7,222,372,6,121,402,41,87,382,67,221,346,55,559,93,-13,528,47,39,505,21,-111,528,54,-101,616,31,-53,442,256,-15,300,338,19,257,308,-79,408,256,-74,312,352,-26,384,297,-31,437,257,-47,-29,415,53,-232,377,59,-139,335,77,-132,344,2,-18,377,-37,-171,387,-28,-254,384,18,-651,-27,27,-435,-28,179,-345,149,165,-272,-28,23,-215,146,-2,-279,-29,-59,-211,145,-55,-337,-28,-128,-413,247,0,-293,363,24,-214,254,-36,-164,290,33,-284,150,94,-218,362,105,75,369,29,518,147,-63,447,190,-70,445,56,-105,391,185,-60,431,49,-33,459,83,26,470,162,42,130,390,53,167,341,-30,125,394,-45,239,368,-17,91,414,10,450,18,2,449,-27,-9,436,-28,-58,496,-27,-110,582,-28,-140,647,-27,-56,325,325,-45,-307,297,-56,-647,-28,-45,-188,310,-54,-264,197,113,-367,175,139,8,387,82,426,45,-55,114,359,-28,500,27,44,461,-29,13,-512,-27,-151,-152,376,-38,-490,-28,148,12,370,-28,442,160,42,465,194,32,381,183,-33,649,-27,-34,444,16,29,616,-28,25,417,267,-66,-132,352,-34,-322,-27,130,-271,86,-115,-635,-28,-121,-291,203,-99,176,405,-10,561,52,-93,371,305,9,311,237,-22,377,200,-81,-129,406,46,-154,371,99,-82,361,71,-21,354,26,-91,363,-27,-165,413,-12,-414,215,110,-238,127,26,-408,-28,-128,-674,-28,-94,-446,232,-39,-311,226,-90,-255,210,-61,-235,192,-11,-217,218,58,-269,299,124,-386,276,78,-399,281,42,15,373,58,16,393,75,549,107,-46,481,188,-68,409,120,-41,541,81,12,230,368,41,194,350,-50,224,361,-50,604,-28,-10,602,-27,35,486,56,-121,502,69,-120,457,-27,-110,226,317,-40,-584,-28,-124,439,-26,-30,467,-26,39,547,-27,-146,21,368,14,466,229,-29,578,-27,44,609,-27,-96,291,356,-15,290,306,34,255,321,28,231,311,-5,-251,386,50,-183,307,87,-152,307,24,-264,373,-12,-392,-27,190,-333,-28,84,-281,-27,54,-270,-28,-23,-308,-28,-101,-687,-27,-59,39,418,39,413,163,25,404,206,-90,54,400,-31,121,352,8,-454,41,148,-426,9,182,-564,115,3,-427,27,-107,-548,118,-32,-556,122,-53,-517,91,-101,-475,54,140,-461,52,-134,-558,119,-71,-434,286,59,-687,-31,52,-595,146,22,-670,-28,164,-537,166,122,-575,-28,217,-566,159,65,-470,152,136,-712,-29,102,-639,-29,211,-532,-30,181,-442,-30,-100],faces:[76,104,162,1,176,103,103,76,1,2,119,73,73,105,2,2,118,152,45,161,46,46,109,45,3,120,49,49,68,3,3,121,139,139,48,3,4,122,94,94,121,4,6,123,124,9,175,81,10,169,111,10,67,92,88,43,146,11,131,114,11,128,183,13,130,15,90,184,174,90,182,184,130,184,63,14,130,63,15,130,14,16,131,12,15,168,53,18,91,17,131,16,17,65,133,132,65,132,91,67,134,166,166,92,67,20,135,92,20,166,4,4,121,20,22,135,68,25,102,96,25,157,102,69,138,157,69,157,25,39,150,71,71,141,39,28,150,149,149,72,28,142,176,105,36,140,27,27,143,36,32,115,81,32,144,161,161,80,32,77,35,144,34,26,77,78,179,96,145,152,78,178,79,145,80,146,79,147,140,36,143,108,36,143,37,148,74,95,154,154,83,74,72,149,151,151,95,72,38,150,156,40,147,106,70,140,40,40,116,70,42,162,0,35,163,162,43,145,146,46,117,41,47,158,27,48,139,175,122,138,94,157,138,123,52,178,102,52,102,6,52,124,7,7,100,52,53,125,8,57,93,181,56,169,181,59,127,58,60,173,61,62,128,11,11,112,62,65,91,167,65,167,66,126,93,21,22,68,49,72,95,29,142,29,74,74,82,142,75,107,97,75,97,103,76,97,37,104,143,31,78,152,164,78,164,179,79,178,8,97,155,159,107,98,155,83,98,82,154,95,84,39,116,86,86,156,39,87,160,116,24,145,96,162,104,0,105,118,2,43,177,119,44,177,43,91,51,167,44,88,109,46,161,117,3,68,121,3,48,120,4,166,50,50,122,4,5,123,122,123,138,122,110,124,51,170,10,111,110,91,7,7,124,110,8,125,9,9,81,8,186,12,188,92,135,10,11,114,112,64,63,137,13,15,89,89,53,100,64,168,14,14,168,15,89,100,16,16,12,89,100,18,16,17,91,132,112,19,61,18,7,91,19,17,132,133,127,59,133,59,61,136,21,22,134,127,133,20,92,166,121,135,20,158,31,27,21,135,22,23,137,136,24,102,178,178,145,24,25,179,69,26,94,138,27,140,70,27,70,141,150,177,71,28,177,150,29,142,73,73,119,29,142,82,30,30,176,142,107,75,82,31,143,27,33,81,175,31,41,104,115,79,8,32,33,144,80,115,32,33,175,139,35,162,42,77,139,34,163,26,179,163,179,164,78,96,145,177,29,119,108,143,148,148,37,159,97,159,37,74,83,82,38,149,150,156,150,39,40,106,87,87,116,40,140,147,40,161,144,42,42,117,161,41,0,104,41,117,0,0,117,42,164,118,163,1,163,118,118,176,1,118,105,176,152,118,164,43,152,145,43,119,2,71,109,141,47,41,158,44,71,177,45,109,88,45,88,146,46,47,109,141,47,27,167,50,166,49,120,165,139,121,94,5,122,50,123,51,124,157,6,102,157,123,6,100,8,178,5,167,51,6,124,52,100,178,52,53,168,125,125,165,120,54,125,168,9,48,175,120,9,125,93,10,135,181,101,56,57,169,10,59,172,61,67,170,171,67,171,127,58,127,171,129,186,113,60,61,172,61,173,112,62,112,173,174,189,129,165,64,23,64,137,23,165,22,49,64,54,168,17,114,131,17,112,114,66,133,65,19,132,133,19,133,61,134,133,66,166,134,66,166,66,167,93,135,21,68,135,121,23,136,22,94,34,139,25,96,179,26,138,69,69,179,26,30,103,176,116,141,70,39,141,116,73,142,105,143,76,37,26,35,77,103,97,76,77,144,33,33,139,77,38,151,149,80,161,45,80,45,146,81,115,8,107,155,97,82,98,107,95,151,84,38,156,85,86,116,160,96,102,24,72,29,28,29,95,74,75,30,82,108,147,36,88,44,43,91,110,51,170,67,10,11,183,131,64,14,63,89,15,53,100,7,18,112,17,19,127,134,67,136,126,21,158,41,31,33,32,81,115,80,79,177,28,29,43,2,152,71,44,109,47,46,41,141,109,47,167,5,50,123,5,51,100,53,8,125,54,165,9,120,48,93,57,10,59,58,172,174,185,189,165,54,64,165,23,22,94,26,34,30,75,103,143,104,76,26,163,35,38,85,151,192,182,191,183,128,201,12,13,89,181,169,57,186,153,113,188,183,99,184,182,63,185,13,189,180,181,93,186,99,153,189,186,129,185,184,130,186,13,12,187,93,126,193,199,194,194,196,193,200,187,195,187,197,195,187,126,197,197,190,194,190,136,137,190,196,194,63,182,192,63,192,196,192,198,196,191,182,55,193,196,198,194,199,197,195,197,199,136,197,126,190,137,63,190,63,196,197,136,190,192,191,198,201,99,183,90,55,182,181,180,101,185,130,13,186,188,99,186,189,13,187,180,93,200,101,187,183,188,131,184,185,174,180,187,101,16,18,17,12,131,188,35,42,144,163,1,162,76,162,1,79,146,145]}],stones:[{type:"mesh",vertices:[-376,189,42,230,223,-310,353,162,-62,414,-23,-67,256,90,-475,24,85,-526,-418,-16,57,-432,66,-40,-199,151,-376,-155,49,467,-91,289,201,293,197,91,81,-17,-480,42,108,431,-359,-17,-250,383,-19,-243,194,-15,270,-272,180,293,-86,212,262,234,54,297,395,97,-302,-123,-21,-444,-416,-19,-123,-323,-18,267,-100,-16,429,-300,96,-361,163,-19,409,118,201,-431,-241,-18,391,-130,274,-309,306,-19,-399,-221,96,404],faces:[31,18,17,0,17,18,3,20,2,18,11,10,29,27,8,27,29,1,0,18,10,10,29,0,16,19,26,11,2,1,20,30,4,20,3,15,30,12,4,4,12,5,5,27,4,4,27,20,21,25,5,7,8,25,22,7,14,7,25,14,23,28,31,0,7,17,24,26,9,31,28,9,8,27,5,2,20,1,13,19,18,10,11,1,19,13,26,3,11,19,19,16,3,11,3,2,11,18,19,20,15,30,29,10,1,25,21,14,8,5,25,5,12,21,6,7,22,7,6,23,8,0,29,8,7,0,23,31,7,13,31,9,18,31,13,9,28,24,26,13,9,27,1,20,7,31,17]},{type:"mesh",vertices:[-217,34,-153,198,90,20,212,85,169,-131,93,171,197,113,30,173,121,164,315,29,-16,219,24,189,282,50,-102,232,38,-181,-195,-9,-166,-156,30,-207,-51,-9,-231,-180,91,-173,-19,73,-204,-280,23,96,-242,100,107,3,158,-82,109,88,221,275,-10,-40,236,-10,-135,-178,49,184,-1,-10,-243,265,-11,109,-12,-9,237,-36,46,251,-233,86,-81,93,77,-171,-163,133,69,18,16,263,296,44,93,131,-12,-226,-89,-10,-201,-273,-10,-51,-240,-9,110,190,-12,192,-253,-11,-92,42,43,-258,-115,-11,238,168,99,-88,-285,-10,24,71,124,-158,298,-10,10,116,150,-24,-282,44,39],faces:[44,16,26,13,26,16,0,26,13,27,14,41,4,5,1,7,30,2,28,5,43,41,39,27,17,43,41,43,4,39,13,28,17,17,41,13,28,43,17,24,29,38,29,35,7,18,25,29,5,18,2,18,5,3,30,42,6,30,35,23,19,20,8,8,20,9,9,39,8,1,30,8,31,37,9,11,14,37,14,27,37,32,11,12,11,37,12,11,0,13,33,40,44,44,26,33,33,0,36,34,38,15,44,40,15,21,3,16,27,39,9,2,30,1,21,25,3,16,3,28,28,3,5,4,43,5,41,43,39,13,16,28,25,21,38,38,29,25,7,18,29,29,24,35,18,7,2,18,3,25,30,23,42,30,7,35,8,30,6,6,19,8,6,42,19,8,39,1,37,31,22,27,9,37,9,20,31,10,11,32,11,10,0,12,37,22,14,13,41,14,11,13,33,26,0,36,0,10,21,44,15,16,44,21,15,40,34,38,21,15,4,1,39,5,2,1]},{type:"mesh",vertices:[-101,102,57,99,35,102,40,72,80,59,14,-168,-186,22,45,-176,25,-30,66,-7,146,153,-7,53,-110,47,-96,-90,-8,-146,150,-7,-12,-200,-7,8,-173,-7,-55,55,46,-60,125,-7,110,136,30,-10,-149,58,68,-15,82,-71,98,-7,-86,-34,-6,-194,-33,-7,171,-36,65,137,38,-8,-192,-103,-9,147,-12,62,-152],faces:[2,17,0,17,8,0,17,24,8,19,24,22,5,11,4,2,13,17,17,13,24,21,23,20,1,2,21,7,15,1,7,10,15,5,9,12,15,18,13,0,5,16,0,8,5,1,15,2,10,18,15,3,13,18,24,3,22,11,23,4,4,16,5,16,4,23,24,13,3,15,13,2,6,1,21,6,21,20,6,14,1,2,0,21,1,14,7,3,18,22,8,24,19,8,19,9,12,11,5,5,8,9,16,23,21,16,21,0]},{type:"mesh",vertices:[86,55,-18,58,38,73,97,-12,79,135,7,10,-93,-11,-72,-133,5,33,13,68,-32,94,-11,-57,-90,52,53,-24,-11,-106,-13,-10,104,-75,49,-69,-12,18,114,49,-12,-96,-46,-11,-85,-119,-11,-26,48,5,-111,-58,-11,105,-117,-12,52,-5,35,-93,123,-11,7],faces:[5,8,11,2,3,1,8,1,6,11,8,6,6,19,11,10,12,17,20,7,3,3,7,16,16,0,3,16,9,19,14,4,9,15,18,5,5,11,15,18,17,5,19,0,16,1,3,0,0,6,1,19,6,0,12,8,17,2,1,12,12,10,2,1,8,12,3,2,20,16,13,9,16,7,13,19,4,11,15,11,4,17,8,5,9,4,19]}],torii:[{type:"mesh",mirror:!0,flatShading:!0,vertices:[692,966,-52,661,834,-52,692,966,52,661,834,52,0,894,-52,0,776,-52,0,894,52,0,776,52,518,935,52,345,913,52,170,899,52,162,779,52,328,790,52,494,808,52,170,899,-52,345,913,-52,518,935,-52,494,808,-52,328,790,-52,162,779,-52,0,618,16,0,697,16,0,618,-16,0,697,-16,586,618,16,586,697,16,586,618,-16,586,697,-16,331,-29,-75,331,766,-52,369,-29,-65,357,766,-45,396,-29,-37,377,766,-26,406,-29,0,384,766,0,396,-29,37,377,766,26,369,-29,65,357,766,45,331,-29,75,331,766,52,294,-29,65,305,766,45,267,-29,37,286,766,26,257,-29,0,279,766,0,267,-29,-37,286,766,-26,294,-29,-65,305,766,-45,0,777,85,0,681,33,333,762,-75,333,806,-75,371,762,-65,371,806,-65,398,762,-37,398,806,-37,408,762,0,408,806,0,398,762,37,398,806,37,371,762,65,371,806,65,333,762,75,333,806,75,296,762,65,296,806,65,268,762,37,268,806,37,258,762,0,258,806,0,268,762,-37,268,806,-37,296,762,-65,296,806,-65,0,681,-33,0,777,-85,52,681,33,52,777,85,52,681,-33,52,777,-85],faces:[4,10,14,1,13,17,11,6,7,0,3,1,16,1,17,4,19,5,14,18,19,15,17,18,3,8,13,13,9,12,12,10,11,19,7,5,19,12,11,18,13,12,16,2,0,15,8,16,14,9,15,23,26,22,27,24,26,25,20,24,26,20,22,23,25,27,29,30,28,31,32,30,33,34,32,35,36,34,37,38,36,39,40,38,41,42,40,43,44,42,45,46,44,47,48,46,49,50,48,51,28,50,55,56,54,57,58,56,59,60,58,61,62,60,63,64,62,79,81,83,65,66,64,82,53,78,67,68,66,81,53,80,69,70,68,83,80,82,71,72,70,79,82,78,73,74,72,75,63,59,75,76,74,77,54,76,60,68,76,4,6,10,1,3,13,11,10,6,0,2,3,16,0,1,4,14,19,14,15,18,15,16,17,3,2,8,13,8,9,12,9,10,19,11,7,19,18,12,18,17,13,16,8,2,15,9,8,14,10,9,23,27,26,27,25,24,25,21,20,26,24,20,23,21,25,29,31,30,31,33,32,33,35,34,35,37,36,37,39,38,39,41,40,41,43,42,43,45,44,45,47,46,47,49,48,49,51,50,51,29,28,55,57,56,57,59,58,59,61,60,61,63,62,63,65,64,79,52,81,65,67,66,82,80,53,67,69,68,81,52,53,69,71,70,83,81,80,71,73,72,79,83,82,73,75,74,59,57,55,55,77,75,75,73,71,71,69,75,67,65,63,63,61,59,59,55,75,75,69,67,67,63,75,75,77,76,77,55,54,76,54,56,56,58,76,60,62,68,64,66,68,68,70,72,72,74,68,76,58,60,62,64,68,68,74,76]}],hexagons:[{type:"extrude",vertices:[-.198,-.302,.197,-.3,.372,0,.199,.298,-.202,.298,-.368,0]}],towers:[{type:"extrude",vertices:[-.054,-.178,-.007,-.182,.069,-.027,.189,.079,.178,.124,-.007,.097,-.145,.182,-.178,.144,-.079,-.021]},{type:"lathe",segments:4,vertices:[.004,.02,.012,.092,.042,.166,.067,.55,.101,.594,.105,.838,.193,.934,.18,.994]},{type:"lathe",segments:5,vertices:[.069,.216,.067,.562,.126,.562,.128,.774,.191,.774,.193,.986]}],trees:[{type:"lathe",noise:.015,segments:6,vertices:[.004,.826,.054,.832,.105,.854,.136,.9,.136,.958,.118,.994]},{type:"lathe",noise:.015,segments:14,vertices:[.004,.01,.069,.022,.13,.068,.178,.18,.189,.32,.191,.59,.193,.75,.138,.79,.018,.808,.018,.996]},{type:"lathe",noise:.015,segments:14,vertices:[.002,.436,.126,.46,.201,.57,.219,.72,.154,.846,.028,.884,.034,.996]}],apparatus:[{type:"lathe",segments:10,vertices:[.004,.23,.042,.23,.069,.36,.038,.362,.038,.372,.06,.372,.073,.572,.024,.572,.024,.67,.069,.67,.075,.722,.097,.724,.105,.852,.083,.902,.065,.902,.065,.924,.128,.924,.146,.996]},{type:"lathe",segments:16,vertices:[.001,.232,.229,.182,.486,.07,.356,.182,.213,.242,.154,.242,.144,.262,.178,.262,.126,.314,.04,.328,.038,.374,.058,.374,.071,.408,.026,.406,.03,.42,.091,.418,.034,.496,.01,.498,.03,.506,.014,.998]}],mushrooms:[{type:"lathe",noise:.02,segments:14,vertices:[.001,.006,.13,.018,.341,.084,.437,.144,.492,.234,.484,.246,.276,.232,.107,.284,.046,.346,.062,.852,.097,.956,.166,.998]},{type:"lathe",noise:.02,segments:10,vertices:[.001,.562,.091,.572,.172,.61,.223,.666,.256,.74,.258,.806,.246,.824,.062,.826,.065,.948,.097,.998]},{type:"lathe",noise:.02,segments:10,vertices:[.001,.768,.099,.772,.219,.802,.306,.844,.352,.886,.352,.908,.118,.904,.107,.93,.115,.966,.14,.996]}]},this.assets)for(var t=0;t<this.assets[e].length;t++){var i=this.assets[e][t];if("mesh"==i.type)for(var r=0,o=i.vertices.length;r<o;r++)i.vertices[r]/=1e3}this.userFog=this.el.sceneEl.getAttribute("fog"),this.sky=document.createElement("a-sky"),this.sky.setAttribute("radius",200),this.sky.setAttribute("segments-height",6),this.sky.setAttribute("segments-width",6),this.sky.setAttribute("material","side","double"),this.stars=null,this.ground=document.createElement("a-entity"),this.ground.setAttribute("rotation","-90 0 0"),this.ground.classList.add("environmentGround"),this.groundGeometry=null,this.dressing=document.createElement("a-entity"),this.el.appendChild(this.ground),this.el.appendChild(this.dressing),this.el.appendChild(this.sky)},getFogColor:function(e,t){var i;if("color"==e||"none"==e)i=new THREE.Color(this.data.skyColor);else if("gradient"==e)i=new THREE.Color(this.data.horizonColor);else if("atmosphere"==e){var r=[1,.5,.22,.1,.05,0],o=["#C0CDCF","#81ADC5","#525e62","#2a2d2d","#141616","#000"];if(t<=0)return"#000";t=Math.min(1,t);for(var s=0;s<r.length;s++)if(t>r[s]){var a=new THREE.Color(o[s-1]),n=new THREE.Color(o[s]),l=(t-r[s])/(r[s-1]-r[s]);n.lerp(a,l),i=n;break}}return i.multiplyScalar(.9),i.lerp(new THREE.Color(this.data.groundColor),.3),"#"+i.getHexString()},update:function(e){if(!e||void 0===e.preset||e.preset!==this.data.preset){var t=Object.assign({},this.presets[this.data.preset]);e&&void 0!==e.preset||Object.assign(t,this.el.components["super-environment"].attrValue),this.el.setAttribute("super-environment",t)}var i=this.data.skyType,r=new THREE.Vector3(this.data.lightPosition.x,this.data.lightPosition.y,this.data.lightPosition.z);if(r.normalize(),this.sunlight){if(this.sunlight.setAttribute("position",this.data.lightPosition),"atmosphere"!=i){var o=new THREE.Color(this.data.skyColor);o.r=(o.r+1)/2,o.g=(o.g+1)/2,o.b=(o.b+1)/2,this.hemilight.setAttribute("light",{color:"#"+o.getHexString()}),this.sunlight.setAttribute("light",{intensity:.6}),this.hemilight.setAttribute("light",{intensity:.6})}else this.sunlight.setAttribute("light",{intensity:.1+.5*r.y}),this.hemilight.setAttribute("light",{intensity:.1+.5*r.y});this.sunlight.setAttribute("light",{castShadow:this.data.shadow,shadowCameraLeft:-this.data.shadowSize,shadowCameraBottom:-this.data.shadowSize,shadowCameraRight:this.data.shadowSize,shadowCameraTop:this.data.shadowSize})}if(i!=e.skyType||this.data.skyColor!=e.skyColor||this.data.horizonColor!=e.horizonColor){this.sky.removeAttribute("material");var s={side:"double"};s.shader={none:"flat",color:"flat",gradient:"super-gradientshader",atmosphere:"super-skyshader"}[i],this.stars&&this.stars.setAttribute("visible","atmosphere"==i),"color"==i?(s.color=this.data.skyColor,s.fog=!1):"gradient"==i&&(s.topColor=this.data.skyColor,s.bottomColor=this.data.horizonColor),this.sky.setAttribute("material",s)}"atmosphere"==i&&(this.sky.setAttribute("material",{sunPosition:r}),this.setStars(2e3*(1-Math.max(0,8*(r.y+.08))))),this.data.fog>0?this.el.sceneEl.setAttribute("fog",{color:this.getFogColor(i,r.y),far:250}):this.el.sceneEl.removeAttribute("fog"),this.data.lighting!==e.lighting&&(this.sunlight&&(this.sunlight.setAttribute("light",{type:"point"==this.data.lighting?"point":"directional"}),this.sunlight.setAttribute("visible","none"!==this.data.lighting)),this.hemilight&&this.hemilight.setAttribute("visible","none"!==this.data.lighting));var a=!this.groundGeometry||this.data.seed!=e.seed||this.data.ground!=e.ground||this.data.playArea!=e.playArea||this.data.flatShading!=e.flatShading;(a||this.data.groundColor!=e.groundColor||this.data.groundColor2!=e.groundColor2||this.data.groundYScale!=e.groundYScale||this.data.groundTexture!=e.groundTexture||this.data.gridColor!=e.gridColor||this.data.grid!=e.grid)&&(this.updateGround(a),this.hemilight&&this.hemilight.setAttribute("light",{groundColor:this.data.groundColor})),this.data.seed==e.seed&&this.data.dressingOnPlayArea==e.dressingOnPlayArea&&this.data.dressing==e.dressing&&this.data.flatShading==e.flatShading&&this.data.dressingAmount==e.dressingAmount&&this.data.dressingScale==e.dressingScale&&this.data.dressingColor==e.dressingColor&&this.data.dressingVariance.x==e.dressingVariance.x&&this.data.dressingVariance.y==e.dressingVariance.y&&this.data.dressingVariance.z==e.dressingVariance.z&&this.data.dressingUniformScale==e.dressingUniformScale||this.updateDressing(),this.sky.setAttribute("visible","none"!==i),this.el.setAttribute("visible",this.data.active),this.data.active||(this.userFog?this.el.sceneEl.setAttribute("fog",this.userFog):this.el.sceneEl.removeAttribute("fog")),this.dumpParametersDiff()},logPreset:function(){var e="{";for(var t in this.schema)if("preset"!=t){e+=t+": ";var i=this.schema[t].type;e+="vec3"==i?"{ x: "+this.data[t].x+", y: "+this.data[t].y+", z: "+this.data[t].z+"}":"string"==i||"color"==i?'"'+this.data[t]+'"':this.data[t],e+=", "}e+="}",console.log(e)},dumpParametersDiff:function(){function e(e){return Math.floor(1e3*e)/1e3}var t=[],i="none"!=this.data.preset&&this.presets[this.data.preset];for(var r in i&&t.push("preset: "+this.data.preset),this.schema)if(!("preset"==r||i&&void 0===i[r])){var o=i?i[r]:this.schema[r].default,s=this.data[r];if("vec3"==this.schema[r].type){var a=o;"string"==typeof o&&(a={x:(o=o.split(" "))[0],y:o[1],z:o[2]}),e(a.x)==e(s.x)&&e(a.y)==e(s.y)&&e(a.z)==e(s.z)||t.push(r+": "+e(s.x)+" "+e(s.y)+" "+e(s.z))}else o!=s&&("number"==this.schema[r].type&&(s=e(s)),t.push(r+": "+s))}},random:function(e){return parseFloat("0."+Math.sin(9999*this.data.seed*e).toString().substr(7))},updateGround:function(e){if(e){var t="none"!=this.data.ground;if(this.ground.setAttribute("visible",t),!t)return;this.groundGeometry||(this.groundGeometry=new THREE.PlaneGeometry(this.STAGE_SIZE+2,this.STAGE_SIZE+2,15,15));for(var o=new r,s=this.groundGeometry.vertices,a=this.groundGeometry.vertices.length,n=0,l=0,d=0;n<a;n++)if("flat"!=this.data.ground){var h;switch(this.data.ground){case"hills":h=Math.max(0,o.noise(l,d,0));break;case"canyon":h=.2+.8*o.noise(l,d,0),h=Math.min(1,10*Math.pow(h,2));break;case"spikes":h=this.random(n)<.02?this.random(n+1):0;break;case"noise":h=this.random(n)<.35?this.random(n+1):0}h+=.1*this.random(n+2);var g=2*l/10-1,c=2*d/10-1,u=this.data.playArea;h*=(g=Math.max(0,Math.min(1,(Math.abs(g)-(u-.9))*(1/u))))>(c=Math.max(0,Math.min(1,(Math.abs(c)-(u-.9))*(1/u))))?g:c,s[n].z=h,(l+=.625)>=10&&(l=0,d+=.625)}else s[n].z=0;this.groundGeometry.computeFaceNormals(),this.data.flatShading?this.groundGeometry.computeFlatVertexNormals():this.groundGeometry.computeVertexNormals(),this.groundGeometry.verticesNeedUpdate=!0,this.groundGeometry.normalsNeedUpdate=!0}this.ground.setAttribute("scale",{z:this.data.groundYScale});var m=this.STAGE_SIZE/20,f=function(e){var t={};return"none"!==e.grid&&(t.grid=e.grid,t.gridColor=e.gridColor),t.groundColor=e.groundColor,t.groundColor2=e.groundColor2,t.groundTexture=e.groundTexture,JSON.stringify(t)}(this.data);if(!(f in i)){var p=document.createElement("canvas");p.width=2048,p.height=2048;var y=new THREE.Texture(p);y.wrapS=THREE.RepeatWrapping,y.wrapT=THREE.RepeatWrapping,y.repeat.set(m,m);var v=document.createElement("canvas");v.width=2048,v.height=2048;var b=new THREE.Texture(v);b.wrapS=THREE.RepeatWrapping,b.wrapT=THREE.RepeatWrapping,b.repeat.set(m,m);var C=new THREE.MeshLambertMaterial({map:b,emissive:new THREE.Color(16777215),emissiveMap:y});this.data.flatShading&&(C.flatShading=!0);var E=v.getContext("2d"),x=p.getContext("2d");this.drawTexture(E,2048,20),x.fillStyle="#000000",x.fillRect(0,0,2048,2048),this.drawGrid(x,2048,20),b.needsUpdate=!0,y.needsUpdate=!0,i[f]=C}C=i[f];if(e){var T=new THREE.Mesh(this.groundGeometry,C);this.ground.setObject3D("mesh",T)}else this.ground.getObject3D("mesh").material=C;this.ground.setAttribute("shadow",{cast:!1,receive:this.data.shadow})},drawGrid:function(e,t,i){if("none"!=this.data.grid){var r,o,s,a=Math.floor(i/2),n=t/(i/2);switch(e.fillStyle=this.data.gridColor,this.data.grid){case"1x1":case"2x2":for("1x1"==this.data.grid&&(a*=2,n=t/i),r=0;r<a;r++)s=Math.floor(r*n),e.fillRect(0,s,t,1),e.fillRect(s,0,1,t);break;case"crosses":var l=Math.floor(n/20);for(r=0;r<a+1;r++)for(s=Math.floor(r*n),o=0;o<a+1;o++){var d=Math.floor(o*n-l);e.fillRect(d,s,2*l,1),e.fillRect(s,d,1,2*l)}break;case"dots":for(r=0;r<a+1;r++)for(o=0;o<a+1;o++)e.beginPath(),e.arc(Math.floor(o*n),Math.floor(r*n),4,0,2*Math.PI),e.fill();break;case"xlines":for(r=0;r<a;r++)e.fillRect(Math.floor(r*n),0,1,t);break;case"ylines":for(r=0;r<a;r++)e.fillRect(0,Math.floor(r*n),t,1)}}},drawTexture:function(e,t,i){var o,s,a,n,l,d,h;if(e.fillStyle=this.data.groundColor,e.fillRect(0,0,t,t),"none"!=this.data.groundTexture)switch(this.data.groundTexture){case"checkerboard":e.fillStyle=this.data.groundColor2;var g=Math.floor(i/2),c=t/(i/2);for(o=0;o<g+1;o+=2)for(var u=0;u<g+1;u++)e.fillRect(Math.floor((o+u%2)*c),Math.floor(u*c),Math.floor(c),Math.floor(c));break;case"squares":var m=t/16;for(a=new THREE.Color(this.data.groundColor),n=new THREE.Color(this.data.groundColor2),o=0;o<256;o++)(s=this.random(o+3)>.5?a.clone():n.clone()).addScalar(.1*this.random(o+3)-.05),e.fillStyle="#"+s.getHexString(),e.fillRect(o%16*m,Math.floor(o/16)*m,m,m);break;case"noise":l=(d=e.getImageData(0,0,t,t)).data,a=new THREE.Color(this.data.groundColor),n=new THREE.Color(this.data.groundColor2);var f=new THREE.Color(n.r-a.r,n.g-a.g,n.b-a.b),p=new r;for(o=0,u=0,h=l.length;o<h;o+=4,u++){var y=p.noise(u%t/t*3,u/t/t*3,0);l[o+0]=Math.floor(255*(a.r+f.r*y)),l[o+1]=Math.floor(255*(a.g+f.g*y)),l[o+2]=Math.floor(255*(a.b+f.b*y))}e.putImageData(d,0,0);break;case"walkernoise":var v=Math.floor(t/2),b=document.createElement("canvas");b.width=v,b.height=v;var C=b.getContext("2d");C.fillStyle=this.data.groundColor,C.fillRect(0,0,v,v),l=(d=C.getImageData(0,0,v,v)).data,a=new THREE.Color(this.data.groundColor),n=new THREE.Color(this.data.groundColor2);var E=[];for(o=0;o<1e3;o++)s=a.clone().lerp(n,Math.random()),E.push({x:Math.random()*v,y:Math.random()*v,r:Math.floor(255*s.r),g:Math.floor(255*s.g),b:Math.floor(255*s.b)});for(var x=0;x<5e3;x++)for(o=0;o<1e3;o++){var T=E[o],A=4*Math.floor(T.y*v+T.x);l[A+0]=T.r,l[A+1]=T.g,l[A+2]=T.b,T.x+=Math.floor(3*Math.random())-1,T.y+=Math.floor(3*Math.random())-1,T.x>=v&&(T.x=T.x-v),T.y>=v&&(T.y=T.y-v),T.x<0&&(T.x=v+T.x),T.y<0&&(T.y=v+T.y)}C.putImageData(d,0,0),e.drawImage(b,0,0,t,t)}},getAssetGeometry:function(e){if(!e)return null;var t,i,r,o=[],s=this;function a(e,t){for(var i=new THREE.Vector3,r=0,o=e.vertices.length;r<o;r++)i.x=(s.random(r)-.5)*t,i.y=(s.random(r+o)-.5)*t,i.z=(s.random(r+2*o)-.5)*t,e.vertices[r].add(i)}for(var n=0;n<e.length;n++)if("lathe"==e[n].type){var l=-99999,d=[];for(r=e[n].vertices,t=0;t<r.length;t+=2)d.push(new THREE.Vector2(r[t],r[t+1])),r[t+1]>l&&(l=r[t+1]);(i=new THREE.LatheGeometry(d,e[n].segments||8)).applyMatrix((new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(-Math.PI,0,0))),i.applyMatrix((new THREE.Matrix4).makeTranslation(0,l,0)),e[n].noise&&a(i,e[n].noise),o.push(i)}else if("extrude"==e[n].type){var h=new THREE.Shape;for(r=e[n].vertices,t=0;t<r.length;t+=2)0==t?h.moveTo(r[t],r[t+1]):h.lineTo(r[t],r[t+1]);(i=new THREE.ExtrudeGeometry(h,{amount:1,bevelEnabled:!1})).applyMatrix((new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(-Math.PI/2,0,0))),e[n].noise&&a(i,e[n].noise),o.push(i)}else if("mesh"==e[n].type){i=new THREE.Geometry,r=e[n].vertices;for(var g=e[n].faces,c=0;c<r.length;c+=3)i.vertices.push(new THREE.Vector3(r[c],r[c+1],r[c+2]));for(var u=0;u<g.length;u+=3)i.faces.push(new THREE.Face3(g[u],g[u+1],g[u+2]));this.data.flatShading||e[n].flatShading?i.computeFaceNormals():i.computeVertexNormals(),e[n].mirror&&i.merge(i,(new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(0,Math.PI,0))),e[n].noise&&a(i,e[n].noise),o.push(i)}return o},updateDressing:function(){var e=new THREE.Object3D;if(this.dressing.setAttribute("visible","none"!=this.data.dressing),"none"!=this.data.dressing){var t,i=new THREE.Geometry;switch(this.data.dressing){case"cubes":(t=[new THREE.BoxGeometry(1,1,1)])[0].applyMatrix((new THREE.Matrix4).makeTranslation(0,.5,0));break;case"pyramids":(t=[new THREE.ConeGeometry(1,1,4,1,!0)])[0].applyMatrix((new THREE.Matrix4).makeTranslation(0,.5,0));break;case"cylinders":(t=[new THREE.CylinderGeometry(.5,.5,1,8,1,!0)])[0].applyMatrix((new THREE.Matrix4).makeTranslation(0,.5,0));break;default:if(!(t=this.getAssetGeometry(this.assets[this.data.dressing])))return}for(var r=0,o=88343;r<this.data.dressingAmount;r++,o++){var s,a=t[Math.floor(this.random(33+r)*t.length)],n=this.data.dressingScale,l=new THREE.Vector3(this.data.dressingVariance.x,this.data.dressingVariance.y,this.data.dressingVariance.z);s=this.random(o)<this.data.dressingOnPlayArea?15*this.random(o+1):10+Math.max(l.x,l.z)+10*this.random(o+1)+this.random(o+2)*this.STAGE_SIZE/3;var d=this.random(o+3)*Math.PI*2,h=new THREE.Matrix4,g=this.random(o+4),c=this.data.dressingUniformScale;h.compose(new THREE.Vector3(Math.cos(d)*s,0,Math.sin(d)*s),(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),(this.random(o+5)-.5)*l.length()*Math.PI*2),new THREE.Vector3(n+(c?g:this.random(o+6))*l.x,n+(c?g:this.random(o+7))*l.y,n+(c?g:this.random(o+8))*l.z)),i.merge(a,h)}var u=new THREE.BufferGeometry;u.fromGeometry(i);var m=new THREE.MeshLambertMaterial({color:new THREE.Color(this.data.dressingColor),vertexColors:THREE.VertexColors});this.data.flatShading&&u.computeVertexNormals();var f=new THREE.Mesh(u,m);e.add(f),this.dressing.setObject3D("mesh",e)}},createStars:function(){for(var e=new THREE.BufferGeometry,t=new Float32Array(6e3),i=this.STAGE_SIZE-1,r=new THREE.Vector3,o=0;o<t.length;o+=3)r.set(this.random(o+23)-.5,this.random(o+24),this.random(o+25)-.5),r.normalize(),r.multiplyScalar(i),t[o]=r.x,t[o+1]=r.y,t[o+2]=r.z;e.addAttribute("position",new THREE.BufferAttribute(t,3)),e.setDrawRange(0,0);var s=new THREE.PointsMaterial({size:.01,color:13421772,fog:!1});this.stars.setObject3D("mesh",new THREE.Points(e,s))},setStars:function(e){this.stars||(this.stars=document.createElement("a-entity"),this.stars.id="stars",this.createStars(),this.el.appendChild(this.stars)),e=Math.floor(Math.min(2e3,Math.max(0,e))),this.stars.getObject3D("mesh").geometry.setDrawRange(0,e)}}),AFRAME.registerShader("super-skyshader",{schema:{luminance:{type:"number",default:1,min:0,max:2,is:"uniform"},turbidity:{type:"number",default:2,min:0,max:20,is:"uniform"},reileigh:{type:"number",default:1,min:0,max:4,is:"uniform"},mieCoefficient:{type:"number",default:.005,min:0,max:.1,is:"uniform"},mieDirectionalG:{type:"number",default:.8,min:0,max:1,is:"uniform"},sunPosition:{type:"vec3",default:{x:0,y:0,z:-1},is:"uniform"},color:{type:"color",default:"#fff"}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D skySampler;","uniform vec3 sunPosition;","varying vec3 vWorldPosition;","vec3 cameraPos = vec3(0., 0., 0.);","uniform float luminance;","uniform float turbidity;","uniform float reileigh;","uniform float mieCoefficient;","uniform float mieDirectionalG;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float pn = 0.035;","const vec3 lambda = vec3(680E-9, 550E-9, 450E-9);","const vec3 K = vec3(0.686, 0.678, 0.666);","const float v = 4.0;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3(0.0, 1.0, 0.0);","const float EE = 1000.0;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float cutoffAngle = pi/1.95;","const float steepness = 1.5;","vec3 totalRayleigh(vec3 lambda)","{","return (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn));","}","vec3 simplifiedRayleigh()","{","return 0.0005 / vec3(94, 40, 18);","}","float rayleighPhase(float cosTheta)","{   ","return (3.0 / (16.0*pi)) * (1.0 + pow(cosTheta, 2.0));","}","vec3 totalMie(vec3 lambda, vec3 K, float T)","{","float c = (0.2 * T ) * 10E-18;","return 0.434 * c * pi * pow((2.0 * pi) / lambda, vec3(v - 2.0)) * K;","}","float hgPhase(float cosTheta, float g)","{","return (1.0 / (4.0*pi)) * ((1.0 - pow(g, 2.0)) / pow(1.0 - 2.0*g*cosTheta + pow(g, 2.0), 1.5));","}","float sunIntensity(float zenithAngleCos)","{","return EE * max(0.0, 1.0 - exp(-((cutoffAngle - acos(zenithAngleCos))/steepness)));","}","// Filmic ToneMapping http://filmicgames.com/archives/75","float A = 0.15;","float B = 0.50;","float C = 0.10;","float D = 0.20;","float E = 0.02;","float F = 0.30;","float W = 1000.0;","vec3 Uncharted2Tonemap(vec3 x)","{","return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;","}","void main() ","{","float sunfade = 1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);","float reileighCoefficient = reileigh - (1.0* (1.0-sunfade));","vec3 sunDirection = normalize(sunPosition);","float sunE = sunIntensity(dot(sunDirection, up));","vec3 betaR = simplifiedRayleigh() * reileighCoefficient;","vec3 betaM = totalMie(lambda, K, turbidity) * mieCoefficient;","float zenithAngle = acos(max(0.0, dot(up, normalize(vWorldPosition - cameraPos))));","float sR = rayleighZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","float sM = mieZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","vec3 Fex = exp(-(betaR * sR + betaM * sM));","float cosTheta = dot(normalize(vWorldPosition - cameraPos), sunDirection);","float rPhase = rayleighPhase(cosTheta*0.5+0.5);","vec3 betaRTheta = betaR * rPhase;","float mPhase = hgPhase(cosTheta, mieDirectionalG);","vec3 betaMTheta = betaM * mPhase;","vec3 Lin = pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * (1.0 - Fex),vec3(1.5));","Lin *= mix(vec3(1.0),pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up, sunDirection),5.0),0.0,1.0));","vec3 direction = normalize(vWorldPosition - cameraPos);","float theta = acos(direction.y); // elevation --\x3e y-axis, [-pi/2, pi/2]","float phi = atan(direction.z, direction.x); // azimuth --\x3e x-axis [-pi/2, pi/2]","vec2 uv = vec2(phi, theta) / vec2(2.0*pi, pi) + vec2(0.5, 0.0);","vec3 L0 = vec3(0.1) * Fex;","float sundisk = smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);","L0 += (sunE * 19000.0 * Fex)*sundisk;","vec3 whiteScale = 1.0/Uncharted2Tonemap(vec3(W));","vec3 texColor = (Lin+L0);   ","texColor *= 0.04 ;","texColor += vec3(0.0,0.001,0.0025)*0.3;","float g_fMaxLuminance = 1.0;","float fLumScaled = 0.1 / luminance;     ","float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (g_fMaxLuminance * g_fMaxLuminance)))) / (1.0 + fLumScaled); ","float ExposureBias = fLumCompressed;","vec3 curr = Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);","vec3 color = curr*whiteScale;","vec3 retColor = pow(color,vec3(1.0/(1.2+(1.2*sunfade))));","gl_FragColor.rgb = retColor;","gl_FragColor.a = 1.0;","}"].join("\n")}),AFRAME.registerShader("super-gradientshader",{schema:{topColor:{type:"color",default:"1 0 0",is:"uniform"},bottomColor:{type:"color",default:"0 0 1",is:"uniform"}},vertexShader:["varying vec3 vWorldPosition;","void main() {"," vec4 worldPosition = modelMatrix * vec4( position, 1.0 );"," vWorldPosition = worldPosition.xyz;"," gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 bottomColor;","uniform vec3 topColor;","uniform float offset;","varying vec3 vWorldPosition;","void main() {"," float h = normalize( vWorldPosition ).y;"," gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max(h, 0.0 ), 0.8 ), 0.0 ) ), 1.0 );","}"].join("\n")});var r=function(e){var t;for(void 0==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[],t=0;t<256;t++)this.p[t]=Math.floor(256*e.random(666));for(this.perm=[],t=0;t<512;t++)this.perm[t]=this.p[255&t]};r.prototype.dot=function(e,t,i,r){return e[0]*t+e[1]*i+e[2]*r},r.prototype.mix=function(e,t,i){return(1-i)*e+i*t},r.prototype.fade=function(e){return e*e*e*(e*(6*e-15)+10)},r.prototype.noise=function(e,t,i){var r=Math.floor(e),o=Math.floor(t),s=Math.floor(i);e-=r,t-=o,i-=s,r&=255,o&=255,s&=255;var a=this.perm[r+this.perm[o+this.perm[s]]]%12,n=this.perm[r+this.perm[o+this.perm[s+1]]]%12,l=this.perm[r+this.perm[o+1+this.perm[s]]]%12,d=this.perm[r+this.perm[o+1+this.perm[s+1]]]%12,h=this.perm[r+1+this.perm[o+this.perm[s]]]%12,g=this.perm[r+1+this.perm[o+this.perm[s+1]]]%12,c=this.perm[r+1+this.perm[o+1+this.perm[s]]]%12,u=this.perm[r+1+this.perm[o+1+this.perm[s+1]]]%12,m=this.dot(this.grad3[a],e,t,i),f=this.dot(this.grad3[h],e-1,t,i),p=this.dot(this.grad3[l],e,t-1,i),y=this.dot(this.grad3[c],e-1,t-1,i),v=this.dot(this.grad3[n],e,t,i-1),b=this.dot(this.grad3[g],e-1,t,i-1),C=this.dot(this.grad3[d],e,t-1,i-1),E=this.dot(this.grad3[u],e-1,t-1,i-1),x=this.fade(e),T=this.fade(t),A=this.fade(i),w=this.mix(m,f,x),S=this.mix(v,b,x),M=this.mix(p,y,x),R=this.mix(C,E,x),k=this.mix(w,M,T),z=this.mix(S,R,T);return this.mix(k,z,A)}},function(e,t){AFRAME.registerComponent("geometry-merger",{schema:{deleteOriginalMesh:{default:!1},deleteOriginalEntities:{default:!1},hideOriginalEntities:{default:!0},ignoreWithComponent:{default:""},isParentMerger:{default:!1},materialComponent:{default:"super-material"}},init:function(){var e,t=this;if(this.initialMergeDone=!1,this.mergeCount=0,!this.data.materialComponent||this.el.components[this.data.materialComponent])if(this.geometry=new THREE.Geometry,this.mesh=new THREE.Mesh(this.geometry),this.el.setObject3D("mesh",this.mesh),this.faceIndex={},this.vertexIndex={},this.data.isParentMerger){for(e=0;e<this.el.children.length;e++)this.el.children[e].components["geometry-merger"].initialMergeDone?this.mergeMesh(this.el.children[e].getObject3D("mesh")):this.el.children[e].addEventListener("initialmerge",()=>{this.mergeMesh(this.el.children[e].getObject3D("mesh"))});this.childAttachedHandler=this.childAttachedHandler.bind(this),this.el.addEventListener("child-attached",this.childAttachedHandler)}else this.el.object3D.traverse(this.mergeMesh.bind(this)),this.object3DSetHandler=this.object3DSetHandler.bind(this),this.el.addEventListener("object3dset",this.object3DSetHandler);else this.el.addEventListener("componentinitialized",function e(i){i.detail.name===t.data.materialComponent&&(t.init(),t.el.removeEventListener("componentinitialized",e))})},mergeMesh:function(e){var t;if("Mesh"===e.type&&e!==this.mesh&&e.el!==this.el&&e.geometry&&e.geometry.faces){if(this.data.ignoreWithComponent)for(t in e.el.components)if(e.el.components[t].name===this.data.ignoreWithComponent)return;if((!this.data.isParentMerger||e.el.parentNode===this.el)&&(this.faceIndex[e.parent.uuid]=[this.geometry.faces.length,this.geometry.faces.length+e.geometry.faces.length-1],this.vertexIndex[e.parent.uuid]=[this.geometry.vertices.length,this.geometry.vertices.length+e.geometry.vertices.length-1],e.parent.updateMatrix(),this.geometry.merge(e.geometry,e.parent.matrix),this.geometry.elementsNeedUpdate=!0,this.geometry.computeBoundingSphere(),this.data.hideOriginalEntities&&(e.el.object3D.visible=!1,e.el.object3D.matrixAutoUpdate=!1),this.data.deleteOriginalMesh&&e.parent.remove(e),++this.mergeCount===(parseInt(this.el.dataset.geometryMergerChildCount,10)||this.el.children.length)&&!this.initialMergeDone&&(this.initialMergeDone=!0,this.el.emit("initialmerge",this.el),this.data.deleteOriginalEntities)))for(;this.el.children.length>0;)this.el.removeChild(this.el.children[0])}},remove:function(){var e;if(this.data.hideOriginalEntities)for(e=0;e<this.el.children.length;e++)this.el.children[e].object3D.visible=!0,this.el.children[e].object3D.matrixAutoUpdate=!0;this.geometry.dispose(),this.el.removeObject3D("mesh"),this.childAttachedHandler&&this.el.removeEventListener("child-attached",this.childAttachedHandler),this.object3DSetHandler&&this.el.removeEventListener("object3dset",this.object3DSetHandler)},childAttachedHandler:function(e){var t=this;e.detail.el.parentNode===this.el&&e.detail.el.addEventListener("initialmerge",function e(i){t.mergeMesh(i.detail.getObject3D("mesh")),i.detail.removeEventListener("initialmerge",e)})},object3DSetHandler:function(e){"mesh"===e.detail.type&&this.mergeMesh(e.detail.object)}})},function(e,t){var i="position",r="rotation",o="scale";function s(e){var t;return a(t=document.createElement("a-entity"),e),t}function a(e,t){var s;for(s in t)s===i||s===o?e.object3D[s].copy(t[s]):s===r?e.object3D.rotation.set(t[s].x,t[s].y,t[s].z):e.setAttribute(s,t[s])}e.exports.createEntity=s,e.exports.setAttributes=a,e.exports.createThing=function(e,t){var i,r,o;for(r in o=s(e.attributes),e.shapes)shapeData=e.shapes[r].attributes,i=s(shapeData),o.appendChild(i),t?o.setAttribute("geometry-merger",{deleteOriginalEntities:!0}):o.setAttribute("geometry-merger",""),o.setAttribute("super-material","");return o}},function(e,t,i){var r=i(9);i(8),i(7),i(6),i(5),i(3);var o=new THREE.FileLoader;AFRAME.registerComponent("supercraft-loader",{schema:{includeEnvironment:{default:!0},includeShadows:{default:!0},name:{type:"string"},src:{type:"asset"}},init:function(){this.onLoad=this.onLoad.bind(this)},update:function(){var e,t=this.data,i=this.el;(t.src||t.name)&&(t.includeShadows&&i.setAttribute("shadow",""),e=t.name?"https://supercraftsite.s3-us-west-2.amazonaws.com/"+t.name:t.src,i.setAttribute("geometry-merger","isParentMerger",!0),i.setAttribute("super-material",""),o.load(e,e=>{this.generate(JSON.parse(e)),function(e,t){var i,r=0;for(i=0;i<e.children.length;i++)e.children[i].hasLoaded?r++:e.children[i].addEventListener("loaded",o);function o(i){++r===e.children.length&&t()}}(i,this.onLoad)}))},generate:function(e){var t,i,o,s,a=this.el;for(s in this.data.includeEnvironment&&(t=e.environment?e.environment.presetColor||e.environment.preset:"teal",a.setAttribute("super-environment-updater",{preset:t})),e.entities)i=e.entities[s],o=r.createThing(i),a.appendChild(o)},onLoad:function(){this.el.emit("supercraftloaderloaded")}}),AFRAME.registerComponent("supercraft-visualizer",{schema:{autoplay:{default:!1},deprioritizeThings:{type:"array"},dur:{default:2e3},name:{type:"string"},prioritizeThings:{type:"array"},src:{type:"asset"}},init:function(){this.queueThing=this.queueThing.bind(this),this.currentIndex=0,this.entityIndex={},this.isPlaying=!1,this.isLoaded=!1,this.shapes=[],this.start=!1,this.thingEls={},this.thingIds=[],this.time=void 0,this.el.addEventListener("supercraftvisualizerstart",()=>{this.reset(),this.start=!0})},update:function(e){var t,i=this.data,r=this.el;this.sData&&e.dur!==i.dur&&this.setData(this.sData),(i.src||i.name)&&(r.setAttribute("shadow",""),t=i.name?"https://supercraftsite.s3-us-west-2.amazonaws.com/"+i.name:i.src,o.load(t,e=>{var t=JSON.parse(e);this.createEnvironment(t),this.setData(t)}))},createEnvironment:function(e){var t;t=e.environment?e.environment.presetColor||e.environment.preset:"teal",this.el.sceneEl.setAttribute("super-environment-updater",{preset:t})},setData:function(e){var t,i;for(t in this.sData=e,e.entities)for(i in this.entityIndex[t]=e.entities[t],e.entities[t].shapes)this.entityIndex[i]=e.entities[t].shapes[i];for(t in e.entities)-1===this.data.deprioritizeThings.indexOf(t)&&this.thingIds.push(t);this.thingIds.sort((e,t)=>e<t?-1:e===t?0:e>t?1:void 0),this.data.prioritizeThings.forEach(this.queueThing),this.thingIds.forEach(this.queueThing),this.data.deprioritizeThings.forEach(this.queueThing),this.offset=this.data.dur/this.shapes.length,this.data.autoplay&&(this.start=!0),this.isLoaded=!0},queueThing:function(e){var t,i;for(t in(i=this.entityIndex[e]).shapes)-1===this.shapes.indexOf(i.shapes[t])&&this.shapes.push(this.entityIndex[t])},renderShape:function(e){var t,i;t=this.shapes[e],(i=this.thingEls[t.parentId])||(i=r.createEntity(this.entityIndex[t.parentId].attributes),this.thingEls[t.parentId]=i,this.el.appendChild(i)),i.appendChild(r.createEntity(t.attributes))},reset:function(){this.currentIndex=0,this.el.innerHTML="",this.thingEls={},this.time=void 0},tick:function(e,t){if(this.start&&this.isLoaded)return this.isPlaying=!0,this.start=!1,void(this.time=0);if(this.isPlaying)for(this.time+=t;this.time>this.currentIndex*this.offset;){if(this.currentIndex>=this.shapes.length)return void(this.isPlaying=!1);this.renderShape(this.currentIndex),this.currentIndex++}}})}]);
